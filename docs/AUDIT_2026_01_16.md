# FrostGate Core â€” MVP Alignment Audit Report

**Date**: 2026-01-16
**Auditor**: Claude (Opus 4.5)
**Commit**: b6cca86
**Branch**: claude/audit-frostgate-alignment-mo36H

---

## Executive Summary

| Metric | Value |
|--------|-------|
| **Overall Completion** | **65%** |
| Critical Blockers | 3 |
| High Priority Gaps | 3 |
| Test Files | 31 |
| Contract Sections | 20 |

### Critical Blockers for Production
1. **No request/correlation IDs** - audit/debugging impossible
2. **ci-evidence Makefile target missing** - CI will fail
3. **Logging not wired** - no structured logs in prod

---

## Evidence Collection

### Git Metadata
- **HEAD**: `b6cca86`
- **Branch**: `claude/audit-frostgate-alignment-mo36H`
- **Status**: Clean working tree
- **Last commit**: "Unify doctrine enforcement and governance sims"

### Key Signals Found
| Signal | Status | Evidence |
|--------|--------|----------|
| FastAPI/uvicorn | Present | `api/main.py:1-412`, `requirements.txt:2` |
| ROE/Doctrine Engine | Present | `engine/roe.py:1-81`, `engine/doctrine.py` |
| Tenant Isolation | Partial | JSON-file registry (`tools/tenants/registry.py`) |
| Redis (rate limiting) | Present | `api/ratelimit.py:1-305` |
| PostgreSQL/SQLite | Present | `docker-compose.yml:12-30`, `api/db.py` |
| Health/Ready Probes | Present | `api/main.py:304-332` |
| Structured Logging | Partial | `api/logging_config.py` exists but not called |
| Request/Correlation IDs | **MISSING** | No matches found |
| OPA/Policy | Not implemented | Placeholder only |
| CI/CD | Present | `.github/workflows/ci.yml` |

---

## MVP Blueprint Scoring

| Category | Max | Score | Status |
|----------|-----|-------|--------|
| A) API Surface + Contracts | 15 | 12 | FastAPI + CONTRACT.md present |
| B) Core Decision Engine | 15 | 13 | Unified path, TIE-D, persona gating |
| C) Policy / OPA | 10 | 2 | Placeholder only |
| D) Data Layer | 10 | 7 | Redis + SQLite/Postgres; no migrations |
| E) AuthN/AuthZ + Tenant | 10 | 6 | Scopes work; isolation weak |
| F) Observability | 15 | 6 | Probes exist; no request IDs |
| G) CI/CD | 10 | 7 | Good CI; ci-evidence missing |
| H) Tests | 10 | 8 | 31 tests; missing load tests |
| I) Packaging/Ops | 5 | 4 | Docker/Helm present |
| **TOTAL** | **100** | **65** | |

---

## Pitfalls by Severity

### CRITICAL
| Issue | Evidence | Impact | Fix |
|-------|----------|--------|-----|
| No correlation/request IDs | 0 matches for `request_id` | Cannot trace requests | Add UUID middleware |
| ci-evidence target missing | Makefile line 124 references it | CI fails | Add target |
| Logging config not called | `logging_config.py` never invoked | Logs not structured | Call in lifespan |

### HIGH
| Issue | Evidence | Impact | Fix |
|-------|----------|--------|-----|
| Tenant isolation not enforced | JSON file registry | Cross-tenant leak risk | Add RLS |
| No OPA integration | `pss-restricted.yaml:3` placeholder | No policy-as-code | Defer or integrate |
| Hardcoded ROE config | `engine/roe.py:23-31` | No customization | Policy file loader |

### MEDIUM
| Issue | Evidence | Impact | Fix |
|-------|----------|--------|-----|
| No alembic migrations | No /alembic dir | Schema drift | Create migrations |
| Default API key | `api/auth.py:29` | Security risk | Require in prod |
| Shallow health probe | Only checks file exists | False positives | Add Redis ping |

---

## Top 10 ROI Actions

### 1. Add Request ID Middleware (S)
Add `X-Request-Id` header to all responses for tracing.

**File**: `api/middleware/request_id.py` (new)

### 2. Fix ci-evidence Target (S)
Add missing Makefile target for evidence lane.

**File**: `Makefile` after line 364

### 3. Wire Structured Logging (S)
Call `configure_logging()` in app lifespan.

**File**: `api/main.py:162`

### 4. Add Prod API Key Guard (S)
Fail startup if FG_API_KEY unset in prod.

**File**: `api/main.py` lifespan

### 5. Add Tenant Usage Counting (M)
Increment Redis counter per tenant for billing prep.

**Files**: `api/defend.py`, `api/stats.py`

### 6. Create Alembic Migrations (M)
Initialize alembic and create initial migration.

**New directory**: `/alembic`

### 7. Deepen Health Probe (S)
Add Redis ping to `/health/ready`.

**File**: `api/main.py:318-332`

### 8. Add Correlation ID to Logs (M)
Use loguru bind() for request context.

**Files**: All log calls

### 9. Add OpenAPI Contract Test (S)
Snapshot test for API schema stability.

**File**: `tests/test_openapi_contract.py` (new)

### 10. Document Tenant Onboarding (S)
Reduce friction for new customers.

**File**: `docs/ONBOARDING.md` (new)

---

## SaaS Monetization Readiness

| Capability | Status | Gap |
|------------|--------|-----|
| Tier gating | Not present | Add usage counters |
| Billing hooks | Not present | Add per-tenant metering |
| Audit trail | Partial | Add correlation IDs |
| Tenant isolation | Weak | Needs RLS |
| Policy customization | Hardcoded | Need OPA or config files |

---

## Conclusion

FrostGate Core is at **65% MVP completion**. The decision engine and API surface are solid, but critical observability gaps (request IDs, logging) and a missing CI target block production readiness.

**Priority order**:
1. Request ID middleware
2. Fix ci-evidence
3. Wire logging
4. Prod API key guard
5. Tenant usage counting

With these 5 fixes (all Small-Medium effort), the system reaches ~75-80% and becomes deployable for early adopters.
