[pytest]
testpaths =
    tests
    backend/tests
norecursedirs =
    .venv
    artifacts
    state

# pytest-asyncio: kill the deprecation warning properly

markers =
    smoke: quick sanity checks
    contract: API/UI contract checks
    e2e_http: HTTP e2e tests against a running server
    integration: hits real running server
    asyncio: async tests
    postgres: postgres-only tests

# =============================================================================
# Filter Warnings
# =============================================================================
filterwarnings =
    error
    # anyio MemoryObjectReceiveStream.__del__ fires during GC after TestClient
    # context-manager exits – this is a known starlette/anyio false-positive,
    # not a resource leak in our code.
    ignore:.*MemoryObjectReceiveStream:pytest.PytestUnraisableExceptionWarning
    # psycopg Connection.__del__ fires when SQLAlchemy engines are GC'd at
    # session teardown – not a leak in test code.
    ignore:.*BaseConnection.__del__:pytest.PytestUnraisableExceptionWarning
